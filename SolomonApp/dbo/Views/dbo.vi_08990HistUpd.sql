 

CREATE VIEW vi_08990HistUpd AS

SELECT 	 v.FiscYr, v.CustId, v.CpnyID, 
        --  'NS' docs included in the CRMemo group are really treated as negative credit memos created by a 
        --  void of an SB document.
        PTDAccruedRev00 = SUM(CASE WHEN v.Period = '01' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev01 = SUM(CASE WHEN v.Period = '02' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev02 = SUM(CASE WHEN v.Period = '03' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev03 = SUM(CASE WHEN v.Period = '04' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev04 = SUM(CASE WHEN v.Period = '05' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev05 = SUM(CASE WHEN v.Period = '06' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev06 = SUM(CASE WHEN v.Period = '07' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev07 = SUM(CASE WHEN v.Period = '08' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev08 = SUM(CASE WHEN v.Period = '09' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev09 = SUM(CASE WHEN v.Period = '10' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev10 = SUM(CASE WHEN v.Period = '11' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev11 = SUM(CASE WHEN v.Period = '12' THEN v.Accrued ELSE 0 END),
        PTDAccruedRev12 = SUM(CASE WHEN v.Period = '13' THEN v.Accrued ELSE 0 END),
        
	PTDCrMemo00 = SUM(CASE WHEN v.Period = '01' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END),
	PTDCrMemo01 = SUM(CASE WHEN v.Period = '02' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo02 = SUM(CASE WHEN v.Period = '03' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END),
	PTDCrMemo03 = SUM(CASE WHEN v.Period = '04' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo04 = SUM(CASE WHEN v.Period = '05' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo05 = SUM(CASE WHEN v.Period = '06' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo06 = SUM(CASE WHEN v.Period = '07' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo07 = SUM(CASE WHEN v.Period = '08' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo08 = SUM(CASE WHEN v.Period = '09' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END),
	PTDCrMemo09 = SUM(CASE WHEN v.Period = '10' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo10 = SUM(CASE WHEN v.Period = '11' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo11 = SUM(CASE WHEN v.Period = '12' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	PTDCrMemo12 = SUM(CASE WHEN v.Period = '13' AND v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END),

	PTDDrMemo00 = SUM(CASE WHEN v.Period = '01' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo01 = SUM(CASE WHEN v.Period = '02' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo02 = SUM(CASE WHEN v.Period = '03' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo03 = SUM(CASE WHEN v.Period = '04' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo04 = SUM(CASE WHEN v.Period = '05' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo05 = SUM(CASE WHEN v.Period = '06' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo06 = SUM(CASE WHEN v.Period = '07' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo07 = SUM(CASE WHEN v.Period = '08' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo08 = SUM(CASE WHEN v.Period = '09' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo09 = SUM(CASE WHEN v.Period = '10' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo10 = SUM(CASE WHEN v.Period = '11' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo11 = SUM(CASE WHEN v.Period = '12' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END), 
	PTDDrMemo12 = SUM(CASE WHEN v.Period = '13' AND v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END),
 
	PTDFinChrg00 = SUM(CASE WHEN v.Period = '01' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg01 = SUM(CASE WHEN v.Period = '02' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg02 = SUM(CASE WHEN v.Period = '03' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg03 = SUM(CASE WHEN v.Period = '04' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg04 = SUM(CASE WHEN v.Period = '05' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg05 = SUM(CASE WHEN v.Period = '06' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg06 = SUM(CASE WHEN v.Period = '07' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg07 = SUM(CASE WHEN v.Period = '08' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg08 = SUM(CASE WHEN v.Period = '09' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg09 = SUM(CASE WHEN v.Period = '10' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg10 = SUM(CASE WHEN v.Period = '11' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg11 = SUM(CASE WHEN v.Period = '12' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),
	PTDFinChrg12 = SUM(CASE WHEN v.Period = '13' AND v.DocType = 'FI' THEN v.HistBal ELSE 0 END),

	PTDDisc00 = SUM(CASE WHEN v.Period = '01' THEN v.DiscBal ELSE 0 END),
	PTDDisc01 = SUM(CASE WHEN v.Period = '02' THEN v.DiscBal ELSE 0 END),
	PTDdisc02 = SUM(CASE WHEN v.Period = '03' THEN v.DiscBal ELSE 0 END),
	PTDDisc03 = SUM(CASE WHEN v.Period = '04' THEN v.DiscBal ELSE 0 END),
	PTDDisc04 = SUM(CASE WHEN v.Period = '05' THEN v.DiscBal ELSE 0 END),
	PTDDisc05 = SUM(CASE WHEN v.Period = '06' THEN v.DiscBal ELSE 0 END),
	PTDDisc06 = SUM(CASE WHEN v.Period = '07' THEN v.DiscBal ELSE 0 END),
	PTDDisc07 = SUM(CASE WHEN v.Period = '08' THEN v.DiscBal ELSE 0 END),
	PTDDisc08 = SUM(CASE WHEN v.Period = '09' THEN v.DiscBal ELSE 0 END),
	PTDDisc09 = SUM(CASE WHEN v.Period = '10' THEN v.DiscBal ELSE 0 END),
	PTDDisc10 = SUM(CASE WHEN v.Period = '11' THEN v.DiscBal ELSE 0 END),
	PTDDisc11 = SUM(CASE WHEN v.Period = '12' THEN v.DiscBal ELSE 0 END),
	PTDDisc12 = SUM(CASE WHEN v.Period = '13' THEN v.DiscBal ELSE 0 END),

	PTDRcpt00 = SUM(CASE WHEN v.Period = '01' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt01 = SUM(CASE WHEN v.Period = '02' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt02 = SUM(CASE WHEN v.Period = '03' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt03 = SUM(CASE WHEN v.Period = '04' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt04 = SUM(CASE WHEN v.Period = '05' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt05 = SUM(CASE WHEN v.Period = '06' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt06 = SUM(CASE WHEN v.Period = '07' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt07 = SUM(CASE WHEN v.Period = '08' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt08 = SUM(CASE WHEN v.Period = '09' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt09 = SUM(CASE WHEN v.Period = '10' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt10 = SUM(CASE WHEN v.Period = '11' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt11 = SUM(CASE WHEN v.Period = '12' THEN v.HistRcpt ELSE 0 END),
	PTDRcpt12 = SUM(CASE WHEN v.Period = '13' THEN v.HistRcpt ELSE 0 END),

	PTDSales00 = SUM(CASE WHEN v.Period = '01' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '01' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales01 = SUM(CASE WHEN v.Period = '02' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '02' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales02 = SUM(CASE WHEN v.Period = '03' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '03' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales03 = SUM(CASE WHEN v.Period = '04' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '04' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales04 = SUM(CASE WHEN v.Period = '05' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '05' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales05 = SUM(CASE WHEN v.Period = '06' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '06' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales06 = SUM(CASE WHEN v.Period = '07' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '07' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales07 = SUM(CASE WHEN v.Period = '08' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '08' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales08 = SUM(CASE WHEN v.Period = '09' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '09' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales09 = SUM(CASE WHEN v.Period = '10' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '10' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales10 = SUM(CASE WHEN v.Period = '11' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '11' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales11 = SUM(CASE WHEN v.Period = '12' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '12' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),
	PTDSales12 = SUM(CASE WHEN v.Period = '13' AND v.DocType IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.Period = '13' AND v.DocType IN ('AD','RA') THEN v.Accrued ELSE 0 END),

	YTDAccruedRev = SUM(v.Accrued),
	YtdCrMemo = SUM(CASE WHEN v.DocType IN ('CM', 'SB') THEN v.HistBal ELSE 0 END), 
	YtdDisc = SUM(CASE WHEN v.DocType IN ('CM', 'PA', 'PP') THEN v.DiscBal ELSE 0 END),
	YtdDrMemo = SUM(CASE WHEN v.DocType IN ('DM', 'SC', 'NC') THEN v.HistBal ELSE 0 END),
	YtdFinChrg = SUM(CASE v.DocType WHEN 'FI' THEN v.HistBal ELSE 0 END), 
	YtdRcpt = SUM(v.HistRcpt) , 
	YtdSales = SUM(CASE WHEN v.DocType  IN ('IN', 'CS', 'RF') THEN v.HistBal WHEN v.DocType  IN ('AD', 'RA') THEN v.Accrued ELSE 0 END)
  FROM vi_08990ARBalancesHist v
 
 GROUP BY v.FiscYr, v.CustId, v.CpnyID


 
